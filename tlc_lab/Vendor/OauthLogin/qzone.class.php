<?php include_once( 'qzone/qqConnectAPI.php' );class qzone{	var $loginUrl;	function getUrl(){		$qc = new QC();                return $qc->qq_login();			}	//用户资料	function userInfo(){                            $url = new URL();                                $array = array('oauth_consumer_key'=>$_SESSION['qzone']['access_token']['oauth_token_secret'],'access_token'=>$_SESSION['qzone']['access_token']['oauth_token'],'openid'=>$_SESSION['qzone']['openid']);                                $me = $url->get('https://graph.qq.com/user/get_user_info',$array);		$arrme = json_decode($me);		$user['id']         =  $_SESSION['qzone']['openid'];		$user['uname']       = $arrme->nickname;		$user['province']    = 0;		$user['city']        = 0;		$user['location']    = '';		$user['userface']    = $arrme->figureurl;		$user['sex']         = 0;		//print_r($user);		return $user;	}	//验证用户	function checkUser(){                                $qc = new QC();                $reader = new Recorder();                		//将access token，openid保存!!		//XXX 作为demo,临时存放在session中，网站应该用自己安全的存储系统来存储这些信息		$_SESSION['qzone']['access_token']['oauth_token'] = $qc->qq_callback();                $_SESSION['qzone']['openid']  = $qc->get_openid();                $_SESSION['open_platform_type'] = 'qzone';                $_SESSION['qzone']['access_token']['oauth_token_secret']  = $reader->readInc('appid');		//第三方处理用户绑定逻辑		//将openid与第三方的帐号做关联		return true;	}	//发布一条空间动态	function update($text,$opt){                            $U = new URL();                		$url = 'https://graph.qq.com/share/add_share';		$oauth_token = isset($opt['oauth_token']) ? $opt['oauth_token']: $_SESSION['qzone']['access_token']['oauth_token'];		$oauth_token_secret = isset($opt['oauth_token_secret']) ? $opt['oauth_token_secret']: $_SESSION['qzone']['access_token']['oauth_token_secret'];		$openid = isset($opt['openid']) ? $opt['openid']: $_SESSION['qzone']['openid'];		                $array = array(                    'oauth_consumer_key'=>$oauth_token_secret,                    'access_token'=>$oauth_token,                    'openid'=>$openid,                    //必须（最长36个中文字，超出部分会被截断）                    "title"=>"我在瑞德云课上发表了",                    //必须 （请以http://开头）                    "url"=>"http://www.redcloud.com",                    //可选。禁止使用系统生产的语句进行代替	（最长40个中文字，超出部分会被截断）                    "comment"=> $text,                    //可选	（最长80个中文字，超出部分会被截断）                    "summary"=>$text,                );                                return $U->post($url,$array);	}	//上传一个照片，并发布一条微博	function upload($text,$pic,$opt){                            $U = new URL();		$url = 'https://graph.qq.com/t/add_pic_t';		$oauth_token = isset($opt['oauth_token']) ? $opt['oauth_token']: $_SESSION['qzone']['access_token']['oauth_token'];		$oauth_token_secret = isset($opt['oauth_token_secret']) ? $opt['oauth_token_secret']: $_SESSION['qzone']['access_token']['oauth_token_secret'];		$openid = isset($opt['openid']) ? $opt['openid']: $_SESSION['qzone']['openid'];                                $array = array(                    'oauth_consumer_key'=>$oauth_token_secret,                    'access_token'=>$oauth_token,                    'openid'=>$openid,                    "content"=> $text,                    "pic"=>$pic,                );		return $U->post($url,$array);	}}?>