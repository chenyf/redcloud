<?php include_once( 'sohu/config.php' );require_once('oauth.class.php');include_once('sohu/SohuOAuth.php' );class sohu{	var $loginUrl;	private $__akey;	private $__skey;	public function __construct() {		$this->__akey = SOHU_AKEY;		$this->__skey = SOHU_SKEY;	}	function getUrl($call_back = null) {		if ( empty($this->__akey) || empty($this->__skey) )		return false;		if (is_null($call_back)) {			$call_back = U('career/Oauth/sohucallback');		}		$o = new SohuOAuth( $this->__akey , $this->__skey  );		$keys = $o->getRequestToken();		$this->loginUrl = $o->getAuthorizeUrl1($keys['oauth_token'],urlencode($call_back));		$_SESSION['sohu']['keys'] = $keys;		return $this->loginUrl;	}	//用户资料	function userInfo(){		$url = 'http://api.t.sohu.com/users/show.json';		$me = (array)$this->doClient()->get($url);		$user['id']          = $me['id'];		$user['uname']       = $me['screen_name'];		$user['province']    = '';		$user['city']        = '';		$user['location']    = $me['location'];		$user['userface']    = $me['profile_image_url'];		$user['sex']         = 0;		return $user;	}	private function doClient($opt){		$oauth_token = ( $opt['oauth_token'] )? $opt['oauth_token']:$_SESSION['sohu']['access_token']['oauth_token'];		$oauth_token_secret = ( $opt['oauth_token_secret'] )? $opt['oauth_token_secret']:$_SESSION['sohu']['access_token']['oauth_token_secret'];		return new SohuOAuth( $this->__akey , $this->__skey ,  $oauth_token, $oauth_token_secret  );	}	//验证用户	function checkUser(){		$o = new SohuOAuth( $this->__akey , $this->__skey , $_SESSION['sohu']['keys']['oauth_token'] , $_SESSION['sohu']['keys']['oauth_token_secret']  );		$access_token = $o->getAccessToken(  $_REQUEST['oauth_verifier'] ) ;		$_SESSION['sohu']['access_token'] = $access_token;		$_SESSION['open_platform_type'] = 'sohu';	}	//发布一条微博	function update($text,$opt){		$url = 'http://api.t.sohu.com/statuses/update.json';		$parm['status'] = urlencode($text);		return $this->doClient($opt)->post($url,$parm);	}	//上传一个照片，并发布一条微博	function upload($text,$pic,$opt){		$url = 'http://api.t.sohu.com/statuses/upload.json';		$parm['status'] = urlencode($text);		$parm['pic'] = '@'.$pic;		return $this->doClient($opt)->post($url,$parm,true);	}	function follow($uid,$opt=array())	{		$url = 'http://api.t.sohu.com/friendships/create/id.json';		$parm['id'] = urlencode($uid);		return $this->doClient($opt)->post($url,$parm);	}}?>